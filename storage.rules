rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    
    // Allow users to read any file if they are signed in.
    // You can make this more restrictive later if needed.
    match /{allPaths=**} {
      allow read: if request.auth != null;
    }

    // --- NEW SECURE UPLOAD RULES ---
    
    // Secure Announcement Images
    match /announcement-images/{fileName} {
      allow write: if request.auth != null;
    }
    
    // Secure Purchase Receipts
    match /purchase-receipts/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Secure Leave Documents
    match /leave-documents/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Secure General Receipts
    match /receipts/{userId}/{fileName} {
       allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Secure Support Ticket Attachments (New Rule)
    match /support-ticket-attachments/{userId}/{fileName} {
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}